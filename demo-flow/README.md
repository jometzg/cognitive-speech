# Overall flow in the demonstration

The diagram illustrates the overall flow. Each step has been marked with a number to show the overall sequence of the flow.

![alt text](https://github.com/jometzg/cognitive-speech/blob/master/demo-flow/flow-diagram.png "Flow diagram")

## Steps
1. The diagram illustrates a mobile phone with some means of recording MP3 files and shareing these via email. This has been done as one of the quickest ways in which you can record your own MP3s, but you can "borrow" any MP3 voice recordings (provided these are public domain from elsewhere and email it as an attachment to an email address you configure for the logic app. 
2. An email is sent to an email address with a subject line of "audio". This will allow the logic app not to attempt to process other email arrivals to this account. The MP3 audio file is a normal email file attachment.
3. The "receive-email" logic app is setup to trigger from an email arrival to this account. It checks the subjec line to be "audio" and picks off the file attachment
4. The file attachment is stored in Azure blob storage. This MP3 file in blob storage needs to be "visible" to the Cognitive Services batch transcription service, so must in some way be public. It is not a good idea to make all of the blobs in a blob container public, so in this demonstration a shared-access signature (SAS) is created for the blob container.
5. The logic app makes an HTTP request to Cognitive Services passing in the URL to the MP3 blob just stored. This URL is of the form __storage account/container/blob?SAS__ The call to the batch API of Cognitive services is asynchronous and so this logic app completes here.
6. The batch transrcription API has been previously setup to use a **webhook**. This webhook is called by the batch transcription service on completion of the transcription. This can be several miunutes later. The second logic app is triggered on an HTTP resquest and its endpoint is the one registered with the batch transcription API. So the second logic app will now be triggered.
7. The second logic app has a few things to do. The trigger message from batch transcription returns with the status and another URL which actually contains the transcription details. So this logic app checks the status and if "Succeeded", then finds this URL and calls this using an HTTP request. The response from this contains the result and so is parsed to get the transcription text. Finally, the logic app sends an email back to the originator with the transcription text. It should be noted that the senders email is stored in blob storage in logic app one and is then used to formulate the "To" of the email send in this logic app. Ideally, a database should be used for this, but this is simpler for the purposes of a demonstration.
8. Finally, the user receives an email with the transcription

# Testing without a phone or app
This demonstration may be used directly from an email app, provided you have access to an MP3 file.

There are quite a few public domain audio files. Speeches make [good ones](http://www.obamadownloads.com/mp3s/dnc-2004-speech.mp3)

To test this, download the MP3 and then send it as an attachment. 

![alt text](https://github.com/jometzg/cognitive-speech/blob/master/demo-flow/send-audio-email.png "Send email")

And the response comes back in my inbox:

![alt text](https://github.com/jometzg/cognitive-speech/blob/master/demo-flow/response-email.png "Send email")


> On behalf of the Great state of Illinois. Crossroads of a nation. Land of Lincoln. Let me express my deepest gratitude. For the privilege of addressing this convention. Tonight is a particular honor for me because let's face it. My presents on this stage is pretty unlikely. My father was a foreign student. Born and raised in a small village in Kenya. He grew up herding goats went to school in a tin roof shack. His father my grand father was a cook a domestic servant to the British. But my grand father had larger dreams for his son. Through hard work and perseverance my father got a scholarship to study in a magical place. America. That shown as a beacon of freedom and opportunity to so many who had come before. While studying here. My father met my mother. She was born in a town on the other side of the world in Kansas. Her father worked on oil rigs and farms through most of the Depression. The day after Pearl Harbor by Grand Father signed up for duty. Join Pattons Army marched across Europe. Back home my grandmother raised a baby and went to work on a bomber assembly line. After the war, they studied on the GI Bill bought a house through FHA. And later moved W all the way to Hawaii in search of opportunity. And they too had big dreams for their daughter. A common dream born of two continents. My parents shared not only an improbable love. They shared an abiding faith in the possibilities of this nation. They would give me an African name Barack or blessing, believing that in a tolerant America your name is no barrier to success. They imagine. They imagine me going to the best schools. In the land even though they weren't rich because in a generous America. You don't have to be rich to achieve your potential. There are both passed away now. And yet I know that on this night, they look down on me with great pride. They stand here and I stand here today. Grateful for the diversity of my heritage. Aware that my parents dreams live on in my 2 precious daughters. I stand here knowing that my story is part of the larger American story that. I owe a debt to all of those who came before me and that in no other country on Earth is my story even possible. Tonight. We gather to affirm the greatness of our nation. Not because of the height of our skyscrapers or the power of our military or the size of our economy. Our Pride is based on a very simple premise. Summed up in a declaration made over 200 years ago. We hold these truths to be self evident. That all men are created equal. That they are endowed by their creator with certain inalienable rights that among these are life. Liberty and the pursuit of happiness that is the true genius of America. A faith. A faith in simple dreams. An insistence on small miracles. That we can talk in our children at night. And know that they are fed and clothed and safe from harm. That we can say what we think right what we think without hearing a sudden knocked on the door. That we can have an idea and start our own business. Without paying a bribe. That we can participate in the political process without fear of retribution and that our votes will be counted. At least most of the time. This year in this election, we are called to reaffirm our values and our commitments to hold them against a hard reality and see how we're measuring up to the legacy of our forebears and the promise of future generations and fellow Americans Democrats, Republicans independents. I say to you tonight, we have more work to do. More work to do. For the workers. I met in Galesburg, IL, who are losing their union jobs at the Maytag plant that's moving to Mexico and now we're having to compete with their own children for jobs that pay $7.00 an hour. More to do for the father that I met who was losing his job and choking back. The tears wondering how he would pay $4500 a month for the drugs. His son needs without the health benefits that he counted on. More to do for the young woman in East Saint Louis and thousands more like her who has the grades has the drive has the will but doesn't have the money to go to college. Now don't get me wrong. The people I meet in small towns and big cities and diners. And office parks, they don't expect government to solve all their problems. They know they have to work hard to get ahead and they want to. Go into the collar counties around Chicago and people will tell you they don't want their tax money wasted by a welfare agency or by the Pentagon going. Go into any inner city neighborhood. An folks will tell you that government alone can't teach our kids to learn. They know that parents have to teach that children can achieve unless we raise their expectations, and turn off the television sets and eradicate the slander that says a black youth with a book is acting white they know those things. People don't expect. People don't expect government to solve all their problems. But they sense deep in their bones that would just a slight change in priorities. We can make sure that every child in America has a decent shot at life. And that the doors of opportunity remain open to all they know we can do better. And they want that choice you know. A while back. A while back, I met a young man named Shamus in a VFW Hall in East Moline IL. He was a good looking kid 6263 clear eyed with an easy smile. He told me he joined the Marines and was heading to Iraq, the following week. And as I listened to him explain why he didn't listen. The absolute faith, he had in our country and its leaders. His devotion to duty and service. I thought this young man was all that any of us might ever hope for in a child. But then I ask myself. Are we serving Shamus as well as he serving us? I thought of the 900 men an women sons and daughters husbands and wives friends and neighbors who won't be returning to their own hometowns. I thought of the families. I've met who were struggling to get by without a loved ones full income or whose loved ones had returned with a limb missing. Or nerve shattered but still lack long-term health benefits because they were reservists. When we send our young men and women into harm's way we have a solemn obligation, not to Fudge. The numbers or shave. The truth about why they're going to care for their families. While there gone to 10 to the soldiers upon their return and to never, ever go to war without enough troops to win the war secure the peace an earned the respect of the world. It's not enough for just some of us to prosper. For alongside our famous individualism there's another ingredient in the American saga. A belief that we're all connected as 1 people. If there is a child on the Southside of Chicago who can't read that matters to me, even if it's not my child. If there's a senior citizen somewhere who can pay for their prescription drugs and having to choose between Madison and the rent. That makes my life, poor, even if it's not my grandparents. If there is an air of American family being rounded up without benefit of an attorney or due process that runs my civil liberties. It is that fundamental belief. It is that fundamental belief. I am my brothers keeper. I am my sister's keeper that makes this country work. It's what allows us to pursue our individual dreams. And yet still come together as one American family Ippel Urbes Unum. Out of many one. Now even as we speak. There are those who are preparing to divide us. The Spin Masters, the negative. Add Peddlers, who embrace the politics of anything goes. Well. I say to them tonight. There is not a Liberal America and a Conservative America. There is the United States of America. There is not a black America and a white America and Latinoamerica, an Asian America. There's the United States of America. The fund and the pundits like to slice and dice. Our country in the red States and blue states. Red states for Republicans blue states for Democrats, but I've got news for them to we worship an awesome God in the blue States and we don't like federal agents poking around in our libraries in the red states. We coached Little League in the Blue States and, yes, we got some gay friends in the red states. There are Patriots, who oppose the war in Iraq and their Patriots, who supported the war in Iraq. We are one people. All of us pledging allegiance to the stars and stripes all of us defending the United States of America. In the end. In the end in the end, that's what this election is about. Do we participate in a politics of cynicism or do we participate in a politics of hope. I'm not talking about blind optimism here they almost willful ignorance that thinks unemployment will go away if we just don't think about it or health care crisis will solve itself. If we just ignore it. That's not what I'm talking about. I'm talking about something more substantial. It's the hope of slaves sitting around a fire singing Freedom songs. The hope of immigrants setting out for distant shorts. The hope of a young naval Lieutenant bravely patrolling the Mekong Delta. The hope of a mill worker's son, who dares to defy the odds. The hope of a skinny kid with a funny name who believes that America has a place for him too. Whole. Hope in the face of difficulty hope in the face of uncertainty the audacity of Hope in the end. That is God's greatest gift to us. The bedrock of this nation, a belief in things not seen. A belief that there are better days ahead. I believe that we can give our middle class relief and provide working families with the road to opportunity. I believe we can provide jobs for the jobless homes to the homeless and reclaim young people in cities across America from violence and despair. I believe that we have a righteous wind at our backs and that is, we stand on the crossroads of history. We can make the right choices and meet the challenges that face us. Thank you very much everybody God bless you.
